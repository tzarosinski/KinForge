---
/**
 * MARKDOWN FALLBACK RENDERER
 * 
 * A simple, bulletproof content renderer for when Markdoc fails.
 * Renders plain text content with basic HTML formatting.
 * 
 * Purpose: Ensure adventure content ALWAYS shows, even if Markdoc breaks.
 * This is the "Safe Mode" renderer - no fancy components, just text.
 * 
 * Usage:
 * <MarkdownFallback rawContent={fileContent} showWarning={true} />
 */

interface Props {
  rawContent: string;
  showWarning?: boolean;
}

const { rawContent, showWarning = false } = Astro.props;

// Strip YAML frontmatter (everything before the second ---)
const contentWithoutFrontmatter = rawContent.replace(/^---[\s\S]*?---\n/, '');

// Basic markdown-to-HTML conversion (simple patterns)
let htmlContent = contentWithoutFrontmatter
  .trim()
  // Headers
  .replace(/^### (.*$)/gim, '<h3>$1</h3>')
  .replace(/^## (.*$)/gim, '<h2>$1</h2>')
  .replace(/^# (.*$)/gim, '<h1>$1</h1>')
  // Bold
  .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
  // Italic
  .replace(/\*(.*?)\*/gim, '<em>$1</em>')
  // Line breaks
  .replace(/\n\n/g, '</p><p>')
  // Wrap in paragraph tags
  .replace(/^(.+)$/gim, '<p>$1</p>')
  // Remove empty paragraphs
  .replace(/<p><\/p>/g, '');
---

{showWarning && (
  <div class="mb-6 p-4 bg-yellow-500/10 border-2 border-yellow-500/30 rounded-lg">
    <div class="flex items-start gap-3">
      <span class="text-2xl">üõ°Ô∏è</span>
      <div>
        <p class="text-yellow-300 font-semibold mb-1">
          Safe Mode Active
        </p>
        <p class="text-yellow-200/80 text-sm">
          Adventure loaded with simplified formatting. All game features are still active.
        </p>
      </div>
    </div>
  </div>
)}

<div class="markdown-fallback">
  <Fragment set:html={htmlContent} />
</div>

<style>
  .markdown-fallback {
    color: rgb(226, 232, 240); /* slate-200 */
    line-height: 1.75;
  }

  .markdown-fallback :global(h1) {
    font-size: 2rem;
    font-weight: bold;
    color: white;
    margin-bottom: 1rem;
  }

  .markdown-fallback :global(h2) {
    font-size: 1.5rem;
    font-weight: bold;
    color: white;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
  }

  .markdown-fallback :global(h3) {
    font-size: 1.25rem;
    font-weight: 600;
    color: white;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .markdown-fallback :global(p) {
    margin-bottom: 1rem;
  }

  .markdown-fallback :global(strong) {
    font-weight: 600;
    color: rgb(251, 191, 36); /* yellow-400 */
  }

  .markdown-fallback :global(em) {
    font-style: italic;
    color: rgb(148, 163, 184); /* slate-400 */
  }
</style>
